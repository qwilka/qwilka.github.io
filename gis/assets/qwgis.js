!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/gis/assets/",n(n.s=6)}([function(e,t,n){var r=n(1),a=n(2);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var s={insert:"head",singleton:!1},o=(r(a,s),a.locals?a.locals:{});e.exports=o},function(e,t,n){"use strict";var r,a=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},s=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),o=[];function i(e){for(var t=-1,n=0;n<o.length;n++)if(o[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},r=[],a=0;a<e.length;a++){var s=e[a],l=t.base?s[0]+t.base:s[0],h=n[l]||0,c="".concat(l," ").concat(h);n[l]=h+1;var d=i(c),u={css:s[1],media:s[2],sourceMap:s[3]};-1!==d?(o[d].references++,o[d].updater(u)):o.push({identifier:c,updater:y(u,t),references:1}),r.push(c)}return r}function h(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var a=n.nc;a&&(r.nonce=a)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var o=s(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var c,d=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function u(e,t,n,r){var a=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=d(t,a);else{var s=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function p(e,t,n){var r=n.css,a=n.media,s=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),s&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var f=null,m=0;function y(e,t){var n,r,a;if(t.singleton){var s=m++;n=f||(f=h(t)),r=u.bind(null,n,s,!1),a=u.bind(null,n,s,!0)}else n=h(t),r=p.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=a());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var a=i(n[r]);o[a].references--}for(var s=l(e,t),h=0;h<n.length;h++){var c=i(n[h]);0===o[c].references&&(o[c].updater(),o.splice(c,1))}n=s}}}},function(e,t,n){(t=n(3)(!1)).push([e.i,".leaflet-control-layers-toggle.leaflet-layerstree-named-toggle {\n    margin: 2px 5px;\n    width: auto;\n    height: auto;\n    background-image: none;\n}\n\n.leaflet-layerstree-node {\n}\n\n.leaflet-layerstree-header input{\n    margin-left: 0px;\n}\n\n\n.leaflet-layerstree-header {\n}\n\n.leaflet-layerstree-header-pointer {\n    cursor: pointer;\n}\n\n.leaflet-layerstree-header label {\n    display: inline-block;\n    cursor: pointer;\n}\n\n.leaflet-layerstree-header-label {\n}\n\n.leaflet-layerstree-header-name {\n}\n\n.leaflet-layerstree-header-space {\n}\n\n.leaflet-layerstree-children {\n    padding-left: 10px;\n}\n\n.leaflet-layerstree-children-nopad {\n    padding-left: 0px;\n}\n\n.leaflet-layerstree-closed {\n}\n\n.leaflet-layerstree-opened {\n}\n\n.leaflet-layerstree-hide {\n    display: none;\n}\n\n.leaflet-layerstree-nevershow {\n    display: none;\n}\n\n.leaflet-layerstree-expand-collapse {\n    cursor: pointer;\n}\n",""]),e.exports=t},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var a=(o=r,i=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(l," */")),s=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[n].concat(s).concat([a]).join("\n")}var o,i,l;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(r)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(a[o]=!0)}for(var i=0;i<e.length;i++){var l=[].concat(e[i]);r&&a[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t){!function(e){if(void 0===e)throw new Error("Leaflet must be included first");e.Control.Layers.Tree=e.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"&minus;",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:"",labelIsSelector:"both"},_initClassesNames:function(){this.cls={children:"leaflet-layerstree-children",childrenNopad:"leaflet-layerstree-children-nopad",hide:"leaflet-layerstree-hide",closed:"leaflet-layerstree-closed",opened:"leaflet-layerstree-opened",space:"leaflet-layerstree-header-space",pointer:"leaflet-layerstree-header-pointer",header:"leaflet-layerstree-header",neverShow:"leaflet-layerstree-nevershow",node:"leaflet-layerstree-node",name:"leaflet-layerstree-header-name",label:"leaflet-layerstree-header-label",selAllCheckbox:"leaflet-layerstree-sel-all-checkbox"}},initialize:function(t,n,r){this._scrollTop=0,this._initClassesNames(),this._baseTree=null,this._overlaysTree=null,e.Util.setOptions(this,r),e.Control.Layers.prototype.initialize.call(this,null,null,r),this._setTrees(t,n)},setBaseTree:function(e){return this._setTrees(e)},setOverlayTree:function(e){return this._setTrees(void 0,e)},addBaseLayer:function(e,t){throw"addBaseLayer is disabled"},addOverlay:function(e,t){throw"addOverlay is disabled"},removeLayer:function(e){throw"removeLayer is disabled"},collapse:function(){return this._scrollTop=this._sect().scrollTop,e.Control.Layers.prototype.collapse.call(this)},expand:function(){e.Control.Layers.prototype.expand.call(this);this._sect().scrollTop=this._scrollTop},onAdd:function(t){function n(e){e._layersTreeName&&(a.innerHTML=e._layersTreeName)}var r=e.Control.Layers.prototype.onAdd.call(this,t);if(this.options.namedToggle){var a=this._container.getElementsByClassName("leaflet-control-layers-toggle")[0];e.DomUtil.addClass(a,"leaflet-layerstree-named-toggle"),t.eachLayer((function(e){n(e)})),t.on("baselayerchange",(function(e){n(e.layer)}),this)}return r},expandTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!1),this._localExpand()},collapseTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!0),this._localExpand()},expandSelected:function(t){function n(t){var a=t.parentElement;if(a){if(e.DomUtil.hasClass(a,r.cls.children)&&!e.DomUtil.hasClass(t,r.cls.childrenNopad)&&e.DomUtil.removeClass(a,s),e.DomUtil.hasClass(a,r.cls.node)){var o=a.getElementsByClassName(r.cls.header)[0];r._applyOnTree(o,!1)}n(a)}}var r=this,a=t?this._overlaysList:this._baseLayersList;if(!a)return this;for(var s=this.cls.hide,o=this._layerControlInputs||a.getElementsByTagName("input"),i=0;i<o.length;i++){var l=o[i];this._getLayer&&!!this._getLayer(l.layerId).overlay!=!!t||l.checked&&n(l.parentElement.parentElement.parentElement.parentElement)}return this._localExpand()},_sect:function(){return this._section||this._form},_setTrees:function(e,t){var n=0;function r(e,t,a){return e&&e.layer&&(a||(e.layer._layersTreeName=e.name||e.label),t[n++]=e.layer),e&&e.children&&e.children.length&&e.children.forEach((function(e){r(e,t,a)})),t}function a(e){return Array.isArray(e)?{noShow:!0,children:e}:e}this._layerControlInputs&&(this._layerControlInputs=[]);for(var s=0;s<this._layers.length;++s)this._layers[s].layer.off("add remove",this._onLayerChange,this);this._layers=[],void 0!==e&&(this._baseTree=a(e)),void 0!==t&&(this._overlaysTree=a(t));var o=r(this._baseTree,{});for(var s in o)this._addLayer(o[s],s);var i=r(this._overlaysTree,{},!0);for(s in i)this._addLayer(i[s],s,!0);return this._map?this._update():this},_localExpand:function(){if(this._map&&e.DomUtil.hasClass(this._container,"leaflet-control-layers-expanded")){var t=this._sect().scrollTop;this.expand(),this._sect().scrollTop=t,this._scrollTop=t}return this},_applyOnTree:function(t,n){[{cls:this.cls.children,hide:n},{cls:this.cls.opened,hide:n},{cls:this.cls.closed,hide:!n}].forEach((function(n){for(var r=t.getElementsByClassName(n.cls),a=0;a<r.length;a++){var s=r[a];e.DomUtil.hasClass(s,this.cls.childrenNopad)||(n.hide?e.DomUtil.addClass(s,this.cls.hide):e.DomUtil.removeClass(s,this.cls.hide))}}),this)},_addItem:function(e){},_update:function(){return this._container?(e.Control.Layers.prototype._update.call(this),this._addTreeLayout(this._baseTree,!1),this._addTreeLayout(this._overlaysTree,!0),this._localExpand()):this},_addTreeLayout:function(e,t){if(e){var n=t?this._overlaysList:this._baseLayersList;this._expandCollapseAll(t,this.options.collapseAll,this.collapseTree),this._expandCollapseAll(t,this.options.expandAll,this.expandTree),this._iterateTreeLayout(e,n,t,[],e.noShow),this._checkDisabledLayers&&this._checkDisabledLayers()}},_expandCollapseAll:function(t,n,r,a){var s=t?this._overlaysList:this._baseLayersList;if(a=a||this,n){var o=document.createElement("div");o.className="leaflet-layerstree-expand-collapse",s.appendChild(o),o.innerHTML=n,o.tabIndex=0,e.DomEvent.on(o,"click keydown",(function(e){"keydown"===e.type&&32!==e.keyCode||(o.blur(),r.call(a,t),this._localExpand())}),this)}},_iterateTreeLayout:function(t,n,r,a,s){if(t){var o,i=M("div",this.cls.header,n),l=M("span"),h=M("span"),c=M("span",this.cls.closed,l,this.options.closedSymbol),d=M("span",this.cls.opened,l,this.options.openedSymbol),u=M("span",this.cls.space,null,this.options.spaceSymbol);this.options.selectorBack?(l.insertBefore(u,c),i.appendChild(h),i.appendChild(l)):(l.appendChild(u),i.appendChild(l),i.appendChild(h)),t.selectAllCheckbox&&((o=this._createCheckboxElement(!1)).className+=" "+this.cls.selAllCheckbox);var p=this.cls.hide;if(t.children){var f=M("div",this.cls.children,n),m=t.layer?l:i;e.DomUtil.addClass(m,this.cls.pointer),m.tabIndex=0,e.DomEvent.on(m,"click keydown",(function(t){"keydown"===t.type&&32!==t.keyCode||(m.blur(),e.DomUtil.hasClass(d,p)?(e.DomUtil.addClass(c,p),e.DomUtil.removeClass(d,p),e.DomUtil.removeClass(f,p)):(e.DomUtil.removeClass(c,p),e.DomUtil.addClass(d,p),e.DomUtil.addClass(f,p)),this._localExpand())}),this),o&&a.splice(0,0,n),t.children.forEach((function(e){var t=M("div",this.cls.node,f);this._iterateTreeLayout(e,t,r,a)}),this),o&&a.splice(0,1)}else e.DomUtil.addClass(l,this.cls.neverShow);var y,g=M(t.layer&&("both"===this.options.labelIsSelector||r&&"overlay"===this.options.labelIsSelector||!r&&"base"===this.options.labelIsSelector)?"label":"span",this.cls.label,h);if(t.layer){var v,b=this._map.hasLayer(t.layer),w=r?t.radioGroup:"leaflet-base-layers_"+e.Util.stamp(this);w?v=this._createRadioElement(w,b):E(v=this._createCheckboxElement(b),this),this._layerControlInputs&&this._layerControlInputs.push(v),v.layerId=e.Util.stamp(t.layer),e.DomEvent.on(v,"click",this._onInputClick,this),g.appendChild(v)}t.selectAllCheckbox&&(g.appendChild(o),("string"==typeof(y=t.selectAllCheckbox)||y instanceof String)&&(o.title=t.selectAllCheckbox),e.DomEvent.on(o,"click",(function(e){e.stopPropagation(),C(o.checked,this)}),this),T(n),E(o,this));M("span",this.cls.name,g,t.label);e.DomUtil.addClass(t.collapsed?d:c,p),t.collapsed&&f&&e.DomUtil.addClass(f,p),s&&(e.DomUtil.addClass(i,this.cls.neverShow),e.DomUtil.addClass(f,this.cls.childrenNopad));var _=t.eventedClasses;_ instanceof Array||(_=[_]);for(var N=0;N<_.length;N++){var L=_[N];if(L&&L.className){var x=n.querySelector("."+L.className);x&&e.DomEvent.on(x,L.event||"click",function(e){return function(r){r.stopPropagation();var a,s=(a=e)&&"[object Function]"==={}.toString.call(a)?e(r,n,t,this._map):e;null!=s&&C(s,this)}}(L.selectAll),this)}}}function M(t,n,r,a){var s=e.DomUtil.create(t,n,r);return a&&(s.innerHTML=a),s}function T(e){var t=e.querySelector("input[type=checkbox]"),n=!0,r=!0,a=e.querySelectorAll("input[type=checkbox]");[].forEach.call(a,(function(e){e===t||(e.indeterminate?(n=!1,r=!1):e.checked?r=!1:e.checked||(n=!1))})),n?(t.indeterminate=!1,t.checked=!0):r?(t.indeterminate=!1,t.checked=!1):(t.indeterminate=!0,t.checked=!1)}function E(t,n){a.forEach((function(r){e.DomEvent.on(t,"click",(function(e){T(r)}),n)}),n)}function C(e,t){for(var r=n.getElementsByTagName("input"),a=0;a<r.length;a++){var s=r[a];"checkbox"===s.type&&(s.checked=e,s.indeterminate=!1)}t._onInputClick()}},_createCheckboxElement:function(e){var t=document.createElement("input");return t.type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=e,t}}),e.control.layers.tree=function(t,n,r){return new e.Control.Layers.Tree(t,n,r)}}(L)},function(e,t){!function(e){var t,n=(t=e.documentMode,"onhashchange"in e&&(void 0===t||t>7));L.Hash=function(e,t){this.onHashChange=L.Util.bind(this.onHashChange,this),e&&this.init(e,t)},L.Hash.parseHash=function(e){0===e.indexOf("#")&&(e=e.substr(1));var t=e.split("/");if(4==t.length){var n=parseInt(t[0],10),r=parseFloat(t[1]),a=parseFloat(t[2]),s=t[3].split("-");return!(isNaN(n)||isNaN(r)||isNaN(a))&&{center:new L.LatLng(r,a),zoom:n,layers:s}}return!1},L.Hash.formatHash=function(e){var t=e.getCenter(),n=e.getZoom(),r=Math.max(0,Math.ceil(Math.log(n)/Math.LN2)),a=[],s=this.options;for(var o in s)s.hasOwnProperty(o)&&e.hasLayer(s[o])&&a.push(o);return"#"+[n,t.lat.toFixed(r),t.lng.toFixed(r),a.join("-")].join("/")},L.Hash.prototype={map:null,lastHash:null,parseHash:L.Hash.parseHash,formatHash:L.Hash.formatHash,init:function(e,t){this.map=e,L.Util.setOptions(this,t),this.lastHash=null,this.onHashChange(),this.isListening||this.startListening()},removeFrom:function(e){this.changeTimeout&&clearTimeout(this.changeTimeout),this.isListening&&this.stopListening(),this.map=null},onMapMove:function(){if(this.movingMap||!this.map._loaded)return!1;var e=this.formatHash(this.map);this.lastHash!=e&&(location.replace(e),this.lastHash=e)},movingMap:!1,update:function(){var e=location.hash;if(e!==this.lastHash){var t=this.parseHash(e);if(t){this.movingMap=!0,this.map.setView(t.center,t.zoom);var n=t.layers,r=this.options,a=this;this.map.eachLayer((function(e){a.map.removeLayer(e)})),n.forEach((function(e,t,n){a.map.addLayer(r[e])})),this.movingMap=!1}else this.onMapMove(this.map)}},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var e=this;this.changeTimeout=setTimeout((function(){e.update(),e.changeTimeout=null}),this.changeDefer)}},isListening:!1,hashChangeInterval:null,startListening:function(){this.map.on("moveend layeradd layerremove",this.onMapMove,this),n?L.DomEvent.addListener(e,"hashchange",this.onHashChange):(clearInterval(this.hashChangeInterval),this.hashChangeInterval=setInterval(this.onHashChange,50)),this.isListening=!0},stopListening:function(){this.map.off("moveend layeradd layerremove",this.onMapMove,this),n?L.DomEvent.removeListener(e,"hashchange",this.onHashChange):clearInterval(this.hashChangeInterval),this.isListening=!1},_keyByValue:function(e,t){for(var n in e)if(e.hasOwnProperty(n))return e[n]===t?n:null}},L.hash=function(e,t){return new L.Hash(e,t)},L.Map.prototype.addHash=function(){this._hash=L.hash(this,this.options)},L.Map.prototype.removeHash=function(){this._hash.removeFrom()}}(window)},function(e,t,n){"use strict";n.r(t);n(0),n(4),n(5);let r=" ";class a{static get separator(){return r}static set separator(e){r=e}static parse(e){if(!isNaN(parseFloat(e))&&isFinite(e))return Number(e);const t=String(e).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==t[t.length-1]&&t.splice(t.length-1),""==t)return NaN;let n=null;switch(t.length){case 3:n=t[0]/1+t[1]/60+t[2]/3600;break;case 2:n=t[0]/1+t[1]/60;break;case 1:n=t[0];break;default:return NaN}return/^-|[WS]$/i.test(e.trim())&&(n=-n),Number(n)}static toDms(e,t="d",n){if(isNaN(e))return null;if("string"==typeof e&&""==e.trim())return null;if("boolean"==typeof e)return null;if(e==1/0)return null;if(null==e)return null;if(void 0===n)switch(t){case"d":case"deg":n=4;break;case"dm":case"deg+min":n=2;break;case"dms":case"deg+min+sec":n=0;break;default:t="d",n=4}e=Math.abs(e);let r=null,s=null,o=null,i=null;switch(t){default:case"d":case"deg":s=e.toFixed(n),s<100&&(s="0"+s),s<10&&(s="0"+s),r=s+"°";break;case"dm":case"deg+min":s=Math.floor(e),o=(60*e%60).toFixed(n),60==o&&(o=(0).toFixed(n),s++),s=("000"+s).slice(-3),o<10&&(o="0"+o),r=s+"°"+a.separator+o+"′";break;case"dms":case"deg+min+sec":s=Math.floor(e),o=Math.floor(3600*e/60)%60,i=(3600*e%60).toFixed(n),60==i&&(i=(0).toFixed(n),o++),60==o&&(o=0,s++),s=("000"+s).slice(-3),o=("00"+o).slice(-2),i<10&&(i="0"+i),r=s+"°"+a.separator+o+"′"+a.separator+i+"″"}return r}static toLat(e,t,n){const r=a.toDms(a.wrap90(e),t,n);return null===r?"–":r.slice(1)+a.separator+(e<0?"S":"N")}static toLon(e,t,n){const r=a.toDms(a.wrap180(e),t,n);return null===r?"–":r+a.separator+(e<0?"W":"E")}static toBrng(e,t,n){const r=a.toDms(a.wrap360(e),t,n);return null===r?"–":r.replace("360","0")}static fromLocale(e){const t=123456.789.toLocaleString(),n={thousands:t.slice(3,4),decimal:t.slice(7,8)};return e.replace(n.thousands,"⁜").replace(n.decimal,".").replace("⁜",",")}static toLocale(e){const t=123456.789.toLocaleString(),n={thousands:t.slice(3,4),decimal:t.slice(7,8)};return e.replace(/,([0-9])/,"⁜$1").replace(".",n.decimal).replace("⁜",n.thousands)}static compassPoint(e,t=3){if(![1,2,3].includes(Number(t)))throw new RangeError(`invalid precision ‘${t}’`);e=a.wrap360(e);const n=4*2**(t-1);return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(e*n/360)%n*16/n]}static wrap360(e){return 0<=e&&e<360?e:(e%360+360)%360}static wrap180(e){return-180<e&&e<=180?e:(e+540)%360-180}static wrap90(e){return-90<=e&&e<=90?e:Math.abs((e%360+270)%360-180)-90}}Number.prototype.toRadians=function(){return this*Math.PI/180},Number.prototype.toDegrees=function(){return 180*this/Math.PI};var s=a;class o{constructor(e,t,n){if(isNaN(e)||isNaN(e)||isNaN(e))throw new TypeError(`invalid vector [${e},${t},${n}]`);this.x=Number(e),this.y=Number(t),this.z=Number(n)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}plus(e){if(!(e instanceof o))throw new TypeError("v is not Vector3d object");return new o(this.x+e.x,this.y+e.y,this.z+e.z)}minus(e){if(!(e instanceof o))throw new TypeError("v is not Vector3d object");return new o(this.x-e.x,this.y-e.y,this.z-e.z)}times(e){if(isNaN(e))throw new TypeError(`invalid scalar value ‘${e}’`);return new o(this.x*e,this.y*e,this.z*e)}dividedBy(e){if(isNaN(e))throw new TypeError(`invalid scalar value ‘${e}’`);return new o(this.x/e,this.y/e,this.z/e)}dot(e){if(!(e instanceof o))throw new TypeError("v is not Vector3d object");return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){if(!(e instanceof o))throw new TypeError("v is not Vector3d object");const t=this.y*e.z-this.z*e.y,n=this.z*e.x-this.x*e.z,r=this.x*e.y-this.y*e.x;return new o(t,n,r)}negate(){return new o(-this.x,-this.y,-this.z)}unit(){const e=this.length;if(1==e)return this;if(0==e)return this;const t=this.x/e,n=this.y/e,r=this.z/e;return new o(t,n,r)}angleTo(e,t){if(!(e instanceof o))throw new TypeError("v is not Vector3d object");if(!(t instanceof o||null==t))throw new TypeError("n is not Vector3d object");const n=null==t||this.cross(e).dot(t)>=0?1:-1,r=this.cross(e).length*n,a=this.dot(e);return Math.atan2(r,a)}rotateAround(e,t){if(!(e instanceof o))throw new TypeError("axis is not Vector3d object");const n=t.toRadians(),r=this.unit(),a=e.unit(),s=Math.sin(n),i=Math.cos(n),l=1-i,h=a.x,c=a.y,d=a.z,u=[[l*h*h+i,l*h*c-s*d,l*h*d+s*c],[l*h*c+s*d,l*c*c+i,l*c*d-s*h],[l*h*d-s*c,l*c*d+s*h,l*d*d+i]],p=[u[0][0]*r.x+u[0][1]*r.y+u[0][2]*r.z,u[1][0]*r.x+u[1][1]*r.y+u[1][2]*r.z,u[2][0]*r.x+u[2][1]*r.y+u[2][2]*r.z];return new o(p[0],p[1],p[2])}toString(e=3){return`[${this.x.toFixed(e)},${this.y.toFixed(e)},${this.z.toFixed(e)}]`}}Number.prototype.toRadians=function(){return this*Math.PI/180},Number.prototype.toDegrees=function(){return 180*this/Math.PI};var i=o;const l={WGS84:{a:6378137,b:6356752.314245,f:1/298.257223563}},h={WGS84:{ellipsoid:l.WGS84}};Object.freeze(l.WGS84),Object.freeze(h.WGS84);class c{constructor(e,t,n=0){if(isNaN(e))throw new TypeError(`invalid lat ‘${e}’`);if(isNaN(t))throw new TypeError(`invalid lon ‘${t}’`);if(isNaN(n))throw new TypeError(`invalid height ‘${n}’`);this._lat=s.wrap90(Number(e)),this._lon=s.wrap180(Number(t)),this._height=Number(n)}get lat(){return this._lat}get latitude(){return this._lat}set lat(e){if(this._lat=isNaN(e)?s.wrap90(s.parse(e)):s.wrap90(Number(e)),isNaN(this._lat))throw new TypeError(`invalid lat ‘${e}’`)}set latitude(e){if(this._lat=isNaN(e)?s.wrap90(s.parse(e)):s.wrap90(Number(e)),isNaN(this._lat))throw new TypeError(`invalid latitude ‘${e}’`)}get lon(){return this._lon}get lng(){return this._lon}get longitude(){return this._lon}set lon(e){if(this._lon=isNaN(e)?s.wrap180(s.parse(e)):s.wrap180(Number(e)),isNaN(this._lon))throw new TypeError(`invalid lon ‘${e}’`)}set lng(e){if(this._lon=isNaN(e)?s.wrap180(s.parse(e)):s.wrap180(Number(e)),isNaN(this._lon))throw new TypeError(`invalid lng ‘${e}’`)}set longitude(e){if(this._lon=isNaN(e)?s.wrap180(s.parse(e)):s.wrap180(Number(e)),isNaN(this._lon))throw new TypeError(`invalid longitude ‘${e}’`)}get height(){return this._height}set height(e){if(this._height=Number(e),isNaN(this._height))throw new TypeError(`invalid height ‘${e}’`)}get datum(){return this._datum}set datum(e){this._datum=e}static get ellipsoids(){return l}static get datums(){return h}static parse(...e){if(0==e.length)throw new TypeError("invalid (empty) point");let t=void 0,n=void 0,r=void 0;if("object"==typeof e[0]&&(1==e.length||!isNaN(parseFloat(e[1])))){const a=e[0];if("Point"==a.type&&Array.isArray(a.coordinates)?([n,t,r]=a.coordinates,r=r||0):(null!=a.latitude&&(t=a.latitude),null!=a.lat&&(t=a.lat),null!=a.longitude&&(n=a.longitude),null!=a.lng&&(n=a.lng),null!=a.lon&&(n=a.lon),null!=a.height&&(r=a.height),t=s.wrap90(s.parse(t)),n=s.wrap180(s.parse(n))),null!=e[1]&&(r=e[1]),isNaN(t)||isNaN(n))throw new TypeError(`invalid point ‘${JSON.stringify(e[0])}’`)}if("string"==typeof e[0]&&2==e[0].split(",").length&&([t,n]=e[0].split(","),t=s.wrap90(s.parse(t)),n=s.wrap180(s.parse(n)),r=e[1]||0,isNaN(t)||isNaN(n)))throw new TypeError(`invalid point ‘${e[0]}’`);if(null==t&&null==n&&([t,n]=e,t=s.wrap90(s.parse(t)),n=s.wrap180(s.parse(n)),r=e[2]||0,isNaN(t)||isNaN(n)))throw new TypeError(`invalid point ‘${e.toString()}’`);return new this(t,n,r)}toCartesian(){const e=this.datum?this.datum.ellipsoid:this.referenceFrame?this.referenceFrame.ellipsoid:l.WGS84,t=this.lat.toRadians(),n=this.lon.toRadians(),r=this.height,{a:a,f:s}=e,o=Math.sin(t),i=Math.cos(t),h=Math.sin(n),c=Math.cos(n),u=2*s-s*s,p=a/Math.sqrt(1-u*o*o);return new d((p+r)*i*c,(p+r)*i*h,(p*(1-u)+r)*o)}equals(e){if(!(e instanceof c))throw new TypeError(`invalid point ‘${e}’`);return!(Math.abs(this.lat-e.lat)>Number.EPSILON)&&(!(Math.abs(this.lon-e.lon)>Number.EPSILON)&&(!(Math.abs(this.height-e.height)>Number.EPSILON)&&(this.datum==e.datum&&(this.referenceFrame==e.referenceFrame&&this.epoch==e.epoch))))}toString(e="d",t,n=null){if(!["d","dm","dms","n"].includes(e))throw new RangeError(`invalid format ‘${e}’`);const r=(this.height>=0?" +":" ")+this.height.toFixed(n)+"m";if("n"==e){return null==t&&(t=4),`${this.lat.toFixed(t)}, ${this.lon.toFixed(t)}${null==n?"":r}`}return`${s.toLat(this.lat,e,t)}, ${s.toLon(this.lon,e,t)}${null==n?"":r}`}}class d extends i{constructor(e,t,n){super(e,t,n)}toLatLon(e=l.WGS84){if(!e||!e.a)throw new TypeError(`invalid ellipsoid ‘${e}’`);const{x:t,y:n,z:r}=this,{a:a,b:s,f:o}=e,i=2*o-o*o,h=i/(1-i),d=Math.sqrt(t*t+n*n),u=s*r/(a*d)*(1+h*s/Math.sqrt(d*d+r*r)),p=u/Math.sqrt(1+u*u),f=p/u,m=isNaN(f)?0:Math.atan2(r+h*s*p*p*p,d-i*a*f*f*f),y=Math.atan2(n,t),g=Math.sin(m),v=d*Math.cos(m)+r*g-a*a/(a/Math.sqrt(1-i*g*g));return new c(m.toDegrees(),y.toDegrees(),v)}toString(e=0){return`[${this.x.toFixed(e)},${this.y.toFixed(e)},${this.z.toFixed(e)}]`}}const u={WGS84:{a:6378137,b:6356752.314245,f:1/298.257223563},Airy1830:{a:6377563.396,b:6356256.909,f:1/299.3249646},AiryModified:{a:6377340.189,b:6356034.448,f:1/299.3249646},Bessel1841:{a:6377397.155,b:6356078.962818,f:1/299.1528128},Clarke1866:{a:6378206.4,b:6356583.8,f:1/294.978698214},Clarke1880IGN:{a:6378249.2,b:6356515,f:1/293.466021294},GRS80:{a:6378137,b:6356752.31414,f:1/298.257222101},Intl1924:{a:6378388,b:6356911.946,f:1/297},WGS72:{a:6378135,b:6356750.5,f:1/298.26}},p={ED50:{ellipsoid:u.Intl1924,transform:[89.5,93.8,123.1,-1.2,0,0,.156]},ETRS89:{ellipsoid:u.GRS80,transform:[0,0,0,0,0,0,0]},Irl1975:{ellipsoid:u.AiryModified,transform:[-482.53,130.596,-564.557,-8.15,1.042,.214,.631]},NAD27:{ellipsoid:u.Clarke1866,transform:[8,-160,-176,0,0,0,0]},NAD83:{ellipsoid:u.GRS80,transform:[.9956,-1.9103,-.5215,-62e-5,.025915,.009426,.011599]},NTF:{ellipsoid:u.Clarke1880IGN,transform:[168,60,-320,0,0,0,0]},OSGB36:{ellipsoid:u.Airy1830,transform:[-446.448,125.157,-542.06,20.4894,-.1502,-.247,-.8421]},Potsdam:{ellipsoid:u.Bessel1841,transform:[-582,-105,-414,-8.3,1.04,.35,-3.08]},TokyoJapan:{ellipsoid:u.Bessel1841,transform:[148,-507,-685,0,0,0,0]},WGS72:{ellipsoid:u.WGS72,transform:[0,0,-4.5,-.22,0,0,.554]},WGS84:{ellipsoid:u.WGS84,transform:[0,0,0,0,0,0,0]}};Object.keys(u).forEach(e=>Object.freeze(u[e])),Object.keys(p).forEach(e=>{Object.freeze(p[e]),Object.freeze(p[e].transform)});class f extends c{constructor(e,t,n=0,r=p.WGS84){if(!r||null==r.ellipsoid)throw new TypeError(`unrecognised datum ‘${r}’`);super(e,t,n),this._datum=r}get datum(){return this._datum}static get ellipsoids(){return u}static get datums(){return p}static parse(...e){let t=p.WGS84;if((4==e.length||3==e.length&&"object"==typeof e[2])&&(t=e.pop()),!t||null==t.ellipsoid)throw new TypeError(`unrecognised datum ‘${t}’`);const n=super.parse(...e);return n._datum=t,n}convertDatum(e){if(!e||null==e.ellipsoid)throw new TypeError(`unrecognised datum ‘${e}’`);return this.toCartesian().convertDatum(e).toLatLon()}toCartesian(){const e=super.toCartesian();return new m(e.x,e.y,e.z,this.datum)}}class m extends d{constructor(e,t,n,r){if(r&&null==r.ellipsoid)throw new TypeError(`unrecognised datum ‘${r}’`);super(e,t,n),r&&(this._datum=r)}get datum(){return this._datum}set datum(e){if(!e||null==e.ellipsoid)throw new TypeError(`unrecognised datum ‘${e}’`);this._datum=e}toLatLon(e){e&&(console.info("datum parameter to Cartesian_Datum.toLatLon is deprecated: set datum before calling toLatLon()"),this.datum=e);const t=this.datum||p.WGS84;if(!t||null==t.ellipsoid)throw new TypeError(`unrecognised datum ‘${t}’`);const n=super.toLatLon(t.ellipsoid);return new f(n.lat,n.lon,n.height,this.datum)}convertDatum(e){if(!e||null==e.ellipsoid)throw new TypeError(`unrecognised datum ‘${e}’`);if(!this.datum)throw new TypeError("cartesian coordinate has no datum");let t=null,n=null;null!=this.datum&&this.datum!=p.WGS84||(t=this,n=e.transform),e==p.WGS84&&(t=this,n=this.datum.transform.map(e=>-e)),null==n&&(t=this.convertDatum(p.WGS84),n=e.transform);const r=t.applyTransform(n);return r.datum=e,r}applyTransform(e){const{x:t,y:n,z:r}=this,a=e[0],s=e[1],o=e[2],i=e[3]/1e6+1,l=(e[4]/3600).toRadians(),h=(e[5]/3600).toRadians(),c=(e[6]/3600).toRadians();return new m(a+t*i-n*c+r*h,s+t*c+n*i-r*l,o-t*h+n*l+r*i)}}class y{constructor(e,t,n,r,a=f.datums.WGS84,s=null,o=null,i=!0){if(!(1<=e&&e<=60))throw new RangeError(`invalid UTM zone ‘${e}’`);if(e!=parseInt(e))throw new RangeError(`invalid UTM zone ‘${e}’`);if("string"!=typeof t||!t.match(/[NS]/i))throw new RangeError(`invalid UTM hemisphere ‘${t}’`);if(i){if(!(0<=n&&n<=1e6))throw new RangeError(`invalid UTM easting ‘${n}’`);if("N"==t.toUpperCase()&&!(0<=r&&r<9328094))throw new RangeError(`invalid UTM northing ‘${r}’`);if("S"==t.toUpperCase()&&!(1118414<r&&r<=1e7))throw new RangeError(`invalid UTM northing ‘${r}’`)}if(!a||null==a.ellipsoid)throw new TypeError(`unrecognised datum ‘${a}’`);this.zone=Number(e),this.hemisphere=t.toUpperCase(),this.easting=Number(n),this.northing=Number(r),this.datum=a,this.convergence=null===s?null:Number(s),this.scale=null===o?null:Number(o)}toLatLon(){const{zone:e,hemisphere:t}=this,{a:n,f:r}=this.datum.ellipsoid,a=this.easting-5e5,s="S"==t?this.northing-1e7:this.northing,o=Math.sqrt(r*(2-r)),i=r/(2-r),l=i*i,h=i*l,c=i*h,d=i*c,u=i*d,p=n/(1+i)*(1+.25*l+1/64*c+1/256*u),f=a/(.9996*p),m=s/(.9996*p),y=[null,.5*i-2/3*l+37/96*h-1/360*c-81/512*d+96199/604800*u,1/48*l+1/15*h-437/1440*c+46/105*d-1118711/3870720*u,17/480*h-37/840*c-209/4480*d+5569/90720*u,4397/161280*c-11/504*d-830251/7257600*u,4583/161280*d-108847/3991680*u,.03233083094085698*u];let v=m;for(let e=1;e<=6;e++)v-=y[e]*Math.sin(2*e*m)*Math.cosh(2*e*f);let b=f;for(let e=1;e<=6;e++)b-=y[e]*Math.cos(2*e*m)*Math.sinh(2*e*f);const w=Math.sinh(b),_=Math.sin(v),N=Math.cos(v),L=_/Math.sqrt(w*w+N*N);let x=null,M=L;do{const e=Math.sinh(o*Math.atanh(o*M/Math.sqrt(1+M*M))),t=M*Math.sqrt(1+e*e)-e*Math.sqrt(1+M*M);x=(L-t)/Math.sqrt(1+t*t)*(1+(1-o*o)*M*M)/((1-o*o)*Math.sqrt(1+M*M)),M+=x}while(Math.abs(x)>1e-12);const T=M,E=Math.atan(T);let C=Math.atan2(w,N),S=1;for(let e=1;e<=6;e++)S-=2*e*y[e]*Math.cos(2*e*m)*Math.cosh(2*e*f);let A=0;for(let e=1;e<=6;e++)A+=2*e*y[e]*Math.sin(2*e*m)*Math.sinh(2*e*f);const O=Math.atan(Math.tan(v)*Math.tanh(b))+Math.atan2(A,S),$=Math.sin(E),k=.9996*(Math.sqrt(1-o*o*$*$)*Math.sqrt(1+T*T)*Math.sqrt(w*w+N*N))*(p/n/Math.sqrt(S*S+A*A));C+=(6*(e-1)-180+3).toRadians();const D=Number(E.toDegrees().toFixed(14)),P=Number(C.toDegrees().toFixed(14)),F=Number(O.toDegrees().toFixed(9)),U=Number(k.toFixed(12)),I=new g(D,P,0,this.datum);return I.convergence=F,I.scale=U,I}static parse(e,t=f.datums.WGS84){if(null==(e=e.trim().match(/\S+/g))||4!=e.length)throw new Error(`invalid UTM coordinate ‘${e}’`);return new this(e[0],e[1],e[2],e[3],t)}toString(e=0){return`${this.zone.toString().padStart(2,"0")} ${this.hemisphere} ${this.easting.toFixed(e)} ${this.northing.toFixed(e)}`}}class g extends f{toUtm(e){if(!(-80<=this.lat&&this.lat<=84))throw new RangeError(`latitude ‘${this.lat}’ outside UTM limits`);let t=e||Math.floor((this.lon+180)/6)+1,n=(6*(t-1)-180+3).toRadians();const r="CDEFGHJKLMNPQRSTUVWXX".charAt(Math.floor(this.lat/8+10));31==t&&"V"==r&&this.lon>=3&&(t++,n+=6..toRadians()),32==t&&"X"==r&&this.lon<9&&(t--,n-=6..toRadians()),32==t&&"X"==r&&this.lon>=9&&(t++,n+=6..toRadians()),34==t&&"X"==r&&this.lon<21&&(t--,n-=6..toRadians()),34==t&&"X"==r&&this.lon>=21&&(t++,n+=6..toRadians()),36==t&&"X"==r&&this.lon<33&&(t--,n-=6..toRadians()),36==t&&"X"==r&&this.lon>=33&&(t++,n+=6..toRadians());const a=this.lat.toRadians(),s=this.lon.toRadians()-n,o=this.datum?this.datum.ellipsoid:f.ellipsoids.WGS84,{a:i,f:l}=o,h=Math.sqrt(l*(2-l)),c=l/(2-l),d=c*c,u=c*d,p=c*u,m=c*p,g=c*m,v=Math.cos(s),b=Math.sin(s),w=Math.tan(s),_=Math.tan(a),N=Math.sinh(h*Math.atanh(h*_/Math.sqrt(1+_*_))),L=_*Math.sqrt(1+N*N)-N*Math.sqrt(1+_*_),x=Math.atan2(L,v),M=Math.asinh(b/Math.sqrt(L*L+v*v)),T=i/(1+c)*(1+.25*d+1/64*p+1/256*g),E=[null,.5*c-2/3*d+5/16*u+41/180*p-127/288*m+7891/37800*g,13/48*d-.6*u+557/1440*p+281/630*m-1983433/1935360*g,61/240*u-103/140*p+15061/26880*m+167603/181440*g,49561/161280*p-179/168*m+6601661/7257600*g,34729/80640*m-3418889/1995840*g,.6650675310896665*g];let C=x;for(let e=1;e<=6;e++)C+=E[e]*Math.sin(2*e*x)*Math.cosh(2*e*M);let S=M;for(let e=1;e<=6;e++)S+=E[e]*Math.cos(2*e*x)*Math.sinh(2*e*M);let A=.9996*T*S,O=.9996*T*C,$=1;for(let e=1;e<=6;e++)$+=2*e*E[e]*Math.cos(2*e*x)*Math.cosh(2*e*M);let k=0;for(let e=1;e<=6;e++)k+=2*e*E[e]*Math.sin(2*e*x)*Math.sinh(2*e*M);const D=Math.atan(L/Math.sqrt(1+L*L)*w)+Math.atan2(k,$),P=Math.sin(a),F=.9996*(Math.sqrt(1-h*h*P*P)*Math.sqrt(1+_*_)/Math.sqrt(L*L+v*v))*(T/i*Math.sqrt($*$+k*k));A+=5e5,O<0&&(O+=1e7),A=Number(A.toFixed(9)),O=Number(O.toFixed(9));const U=Number(D.toDegrees().toFixed(9)),I=Number(F.toFixed(12)),j=this.lat>=0?"N":"S";return new y(t,j,A,O,this.datum,U,I,!!e)}}function v(){fetch(conf_data_path).then(e=>{200!=e.status&&console.error(`load_config failure\nurl=«${url}»\nfetch response status code: ${e.status}`),e.json().catch(e=>{console.error("load_config failure\nresp.json():",e)}).then(e=>{!function(e,t){console.log("makeGis confData",e);let n=e.gisOptions.mapOptions,r=e.gisOptions;e.gisOptions.hasOwnProperty("useCache")&&(_=e.gisOptions.useCache);if((b=L.map("map",{attributionControl:n.attributionControl||!1,zoom:n.zoom||5,minZoom:n.minZoom||2,maxZoom:n.maxZoom||14,maxBounds:n.maxBounds||[[-90,-180],[90,180]],center:n.center||[57,2.46],zoomControl:n.zoomControl||!0})).zoomControl.setPosition("topright"),r.attributionControl){L.control.attribution({position:"bottomright",prefix:'<a target="_blank" href="https://qwilka.github.io/">Qwilka</a>'}).addTo(b)}if(r.scaleControl){L.control.scale({position:"bottomleft",metric:!0,imperial:!1}).addTo(b)}L.tileLayer("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAQMAAABmvDolAAAAA1BMVEX///+nxBvIAAAAH0lEQVQYGe3BAQ0AAADCIPunfg43YAAAAAAAAAAA5wIhAAAB9aK9BAAAAABJRU5ErkJggg==");var a={};let s=e["ftree_vnleaf_"+t.toString()];s||(s=e.tree_vnleaf_0);let o={label:"World base maps &#x1f5fa;",children:[]},i=[];for(let e=0;e<s.length;e++){let t=s[e];"gis-folder-basemaps"===t.type?o=M(t,b,a):t.type.startsWith("gis-folder")&&i.push(M(t,b,a))}new L.Hash(b,a);let l=L.control.layers.tree(o,i,{collapseAll:'<font color="#909090" size="2">(close all)</font>',collapsed:!0});l.addTo(b),l.setPosition("topleft"),l.collapseTree(!1),l.collapseTree(!0),r.locationPopup&&(w=L.popup(),b.on("contextmenu",e=>{N(e)}))}(e,0)})}).catch(e=>{console.error("load_config failure top-level:",e)})}var b;let w;window.onload=()=>{v()};let _=!1;function N(e,t=null){let n,r="https://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv",a=b.layerPointToContainerPoint(e.layerPoint).x,s=b.layerPointToContainerPoint(e.layerPoint).y,o=b.getSize();n=t?t+"<br>Location coordinates:":"Location coordinates:";let i={request:"GetFeatureInfo",service:"WMS",srs:"EPSG:4326",version:"1.1.1",bbox:b.getBounds().toBBoxString(),x:a,y:s,height:o.y,width:o.x,layers:"GEBCO_LATEST_2",query_layers:"GEBCO_LATEST_2",info_format:"text/html"},l=r+L.Util.getParamString(i,r,!0),h=$.ajax({url:l,dataType:"html",success:function(e){console.log("getinfo successfully loaded!\n",e)},error:function(e){console.log("getinfo ERROR!\n",e.statusText)}});$.when(h).done((function(){let e=$.parseHTML(h.responseText);$(e).find("body:first");$.each(e,(function(e,t){if("#text"==t.nodeName){let e=t.nodeValue.match(/Elevation value \(m\):\s*(-?\d+)/);if(e){let t=e[1];n+=t>=0?"<br>elevation "+t+" m (GEBCO)":"<br>depth "+t+" m (GEBCO)",w.setContent(n)}}}))}));let c=e.latlng.lat,d=e.latlng.lng;console.log("long",d,"lat",c);let u=new g(c,d),p=u.convertDatum(g.datums.ED50);console.log("latlong_WGS84 ",u.toString()),p=new g(p.lat,p.lon,0,g.datums.ED50);let f=p.toUtm();n+="<br>long. "+d.toFixed(5)+"&deg;  lat. "+c.toFixed(5)+"&deg; (WGS84)",n+="<br>UTM zone "+f.zone+f.hemisphere,n+="<br>E"+f.easting.toFixed(1)+" N"+f.northing.toFixed(1)+" (ED50)",w.setLatLng(e.latlng).setContent(n).openOn(b)}function x(e){let t=!1;switch(e.data.layerType){case"geojson":t=function(e){let t=null;e.hasOwnProperty("layerOpts")&&(t=e.layerOpts.attribution||null);let n=new L.GeoJSON(null,{style:function(t){let n={color:"#ff0000",weight:2,opacity:1};if(e.hasOwnProperty("style")){e.style.hasOwnProperty("default")&&Object.assign(n,e.style.default);for(const[r,a]of Object.entries(e.style))if(r.indexOf(":")>0){let[e,s]=r.split(":");t.properties.hasOwnProperty(e)&&t.properties[e].toLowerCase()===s.toLowerCase()&&Object.assign(n,a)}}else t.properties.hasOwnProperty("style")&&(n=t.properties.style);return n},onEachFeature:function(t,n){n.on({click:function(n){L.DomEvent.stopPropagation(n);n.latlng.lat,n.latlng.lng;let r="";if(t.properties.hasOwnProperty("name")&&(r+="<b>"+t.properties.name+"</b>"),e.hasOwnProperty("popupProps"))for(let n=0;n<e.popupProps.length;n++){let a=e.popupProps[n];t.properties.hasOwnProperty(a)&&(r+=`<br>${a}: ${t.properties[a]}`)}if(t.properties.hasOwnProperty("KP")){let e=T(t);r+="<br> KP: "+parseFloat(e).toFixed(3)}L.popup().setLatLng(n.latlng).setContent(r).openOn(b)},contextmenu:function(e){L.DomEvent.stopPropagation(e);let n="";if(t.properties.hasOwnProperty("name")&&(n+="<b>"+t.properties.name+"</b>"),t.properties.hasOwnProperty("KP")){let e=T(t);n+="<br> KP: "+parseFloat(e).toFixed(3)}N(e,n)}})},attribution:t}),r=!1;_&&e.cache&&(r=localStorage.getItem(e.layerId));r?(console.log(`localStorage retrieving ${e.layerId}`),r=LZString.decompressFromUTF16(r),r=JSON.parse(r),console.log(`dataObj.cache_timestamp ${r.cache_timestamp}`),n.addData(r.data)):fetch(e.url).then(t=>{200!=t.status&&console.error(`loadGeojson failure\nurl=«${url}»\nfetch response status code: ${t.status}`),t.json().catch(e=>{console.error("loadGeojson failure\nresp.json():",e)}).then(t=>{console.log("loadGeojson data",t),n.addData(t),r={cache_timestamp:Date.now(),type:"geojson",data:t},r=JSON.stringify(r),console.log("dataObj length",r.length),r=LZString.compressToUTF16(r),console.log("compressed length",r.length);try{localStorage.setItem(e.layerId,r)}catch(t){console.error(`localStorage ${t} ${e.layerId}`)}})}).catch(t=>{console.error(`loadGeojson fetch(${e.url}) failure: ${t}`)});return n}(e.data);break;case"tilemap":t=L.tileLayer(e.data.url,e.data.layerOpts);break;case"WMS":t=L.tileLayer.wms(e.data.url,e.data.layerOpts)}return t}function M(e,t,n){let r=[];for(let a=0;a<e.children.length;a++){let s=e.children[a];if(s.type.startsWith("gis-layer")){let e=x(s);if(!e)continue;r.push({label:s.title,layer:e}),s.data.layerId&&(n[s.data.layerId]=e),s.selected&&t.addLayer(e)}else if(s.type.startsWith("gis-folder")){let e=M(s,t,n);r.push(e)}}return{label:e.title,children:r}}function T(e){let t=e.properties.KP,n=turf.lineString(e.geometry.coordinates),r=turf.point([long,lat]),a=turf.nearestPointOnLine(n,r);console.log(a.geometry.coordinates,a.properties.index,a.properties.dist,a.properties.location),console.log("index, dist, location",a.properties.index,a.properties.dist,a.properties.location);let s=a.properties.location;console.log("pt_loc",s);let o=a.properties.index,i=turf.point(e.geometry.coordinates[o]),l=turf.nearestPointOnLine(n,i).properties.location;console.log("pt1_loc",l);let h=turf.point(e.geometry.coordinates[o+1]),c=turf.nearestPointOnLine(n,h).properties.location;console.log("pt2_loc",c);let d=(s-l)/(c-l),u=t[o]*(1-d)+t[o+1]*d;return console.log("eta, KP_near, distance",d,u,a.properties.location),u}}]);