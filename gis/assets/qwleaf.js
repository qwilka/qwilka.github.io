!function(t){var e={};function i(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(a,r,function(e){return t[e]}.bind(null,r));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/gis/assets/",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const a=(t,e)=>{let i=e.node;i.data.hasOwnProperty("_widgetData")||(i.data._widgetData={})},r=(t,e)=>e.typeInfo.icon,n=(t,e)=>e.typeInfo.iconTooltip,s=(t,e)=>{let i=e.tree.getOption("targetWidget"),a=e.node;switch(e.node.type){case"gis-layer-basemap":h(e.tree);break;case"gis-layer":if(a.isSelected()){let t=Object.assign({},a.data);a.data._widgetData.layerStamp=i.addLayer(t)}else i.removeLayerByStamp(a.data._widgetData.layerStamp);break;default:console.log(`select_datatree ${a.title} ${a.type}`)}},o=(t,e)=>{let i=e.node;e.result={url:i.data.fancytree,data:{mode:"children",parent:i.key},cache:!1}},l=(t,e)=>{h(e.tree)},h=t=>{let e=t.getOption("targetWidget"),i=t.getRootNode();e.removeAllLayers(),i.visit(t=>{if(t.data._widgetData={},t.type&&t.isSelected()&&["gis-layer","gis-layer-basemap"].includes(t.type)){let i=Object.assign({},t.data);t.data._widgetData.layerStamp=e.addLayer(i)}})},d=(t,e)=>{switch($.ui.fancytree.getNode(t).type){case"gis-layer-basemap":return{items:{"console-message":{name:"msg to console",icon:"fa-globe",callback:(t,e)=>{console.log("gis-widget: console-message: testing context menu")}}}}}};let c=" ";class u{static get separator(){return c}static set separator(t){c=t}static parse(t){if(!isNaN(parseFloat(t))&&isFinite(t))return Number(t);const e=String(t).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==e[e.length-1]&&e.splice(e.length-1),""==e)return NaN;let i=null;switch(e.length){case 3:i=e[0]/1+e[1]/60+e[2]/3600;break;case 2:i=e[0]/1+e[1]/60;break;case 1:i=e[0];break;default:return NaN}return/^-|[WS]$/i.test(t.trim())&&(i=-i),Number(i)}static toDms(t,e="d",i){if(isNaN(t))return null;if("string"==typeof t&&""==t.trim())return null;if("boolean"==typeof t)return null;if(t==1/0)return null;if(null==t)return null;if(void 0===i)switch(e){case"d":case"deg":i=4;break;case"dm":case"deg+min":i=2;break;case"dms":case"deg+min+sec":i=0;break;default:e="d",i=4}t=Math.abs(t);let a=null,r=null,n=null,s=null;switch(e){default:case"d":case"deg":r=t.toFixed(i),r<100&&(r="0"+r),r<10&&(r="0"+r),a=r+"°";break;case"dm":case"deg+min":r=Math.floor(t),n=(60*t%60).toFixed(i),60==n&&(n=(0).toFixed(i),r++),r=("000"+r).slice(-3),n<10&&(n="0"+n),a=r+"°"+u.separator+n+"′";break;case"dms":case"deg+min+sec":r=Math.floor(t),n=Math.floor(3600*t/60)%60,s=(3600*t%60).toFixed(i),60==s&&(s=(0).toFixed(i),n++),60==n&&(n=0,r++),r=("000"+r).slice(-3),n=("00"+n).slice(-2),s<10&&(s="0"+s),a=r+"°"+u.separator+n+"′"+u.separator+s+"″"}return a}static toLat(t,e,i){const a=u.toDms(u.wrap90(t),e,i);return null===a?"–":a.slice(1)+u.separator+(t<0?"S":"N")}static toLon(t,e,i){const a=u.toDms(u.wrap180(t),e,i);return null===a?"–":a+u.separator+(t<0?"W":"E")}static toBrng(t,e,i){const a=u.toDms(u.wrap360(t),e,i);return null===a?"–":a.replace("360","0")}static fromLocale(t){const e=123456.789.toLocaleString(),i={thousands:e.slice(3,4),decimal:e.slice(7,8)};return t.replace(i.thousands,"⁜").replace(i.decimal,".").replace("⁜",",")}static toLocale(t){const e=123456.789.toLocaleString(),i={thousands:e.slice(3,4),decimal:e.slice(7,8)};return t.replace(/,([0-9])/,"⁜$1").replace(".",i.decimal).replace("⁜",i.thousands)}static compassPoint(t,e=3){if(![1,2,3].includes(Number(e)))throw new RangeError(`invalid precision ‘${e}’`);t=u.wrap360(t);const i=4*2**(e-1);return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(t*i/360)%i*16/i]}static wrap360(t){return 0<=t&&t<360?t:(t%360+360)%360}static wrap180(t){return-180<t&&t<=180?t:(t+540)%360-180}static wrap90(t){return-90<=t&&t<=90?t:Math.abs((t%360+270)%360-180)-90}}Number.prototype.toRadians=function(){return this*Math.PI/180},Number.prototype.toDegrees=function(){return 180*this/Math.PI};var p=u;class g{constructor(t,e,i){if(isNaN(t)||isNaN(t)||isNaN(t))throw new TypeError(`invalid vector [${t},${e},${i}]`);this.x=Number(t),this.y=Number(e),this.z=Number(i)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}plus(t){if(!(t instanceof g))throw new TypeError("v is not Vector3d object");return new g(this.x+t.x,this.y+t.y,this.z+t.z)}minus(t){if(!(t instanceof g))throw new TypeError("v is not Vector3d object");return new g(this.x-t.x,this.y-t.y,this.z-t.z)}times(t){if(isNaN(t))throw new TypeError(`invalid scalar value ‘${t}’`);return new g(this.x*t,this.y*t,this.z*t)}dividedBy(t){if(isNaN(t))throw new TypeError(`invalid scalar value ‘${t}’`);return new g(this.x/t,this.y/t,this.z/t)}dot(t){if(!(t instanceof g))throw new TypeError("v is not Vector3d object");return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){if(!(t instanceof g))throw new TypeError("v is not Vector3d object");const e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,a=this.x*t.y-this.y*t.x;return new g(e,i,a)}negate(){return new g(-this.x,-this.y,-this.z)}unit(){const t=this.length;if(1==t)return this;if(0==t)return this;const e=this.x/t,i=this.y/t,a=this.z/t;return new g(e,i,a)}angleTo(t,e){if(!(t instanceof g))throw new TypeError("v is not Vector3d object");if(!(e instanceof g||null==e))throw new TypeError("n is not Vector3d object");const i=null==e||this.cross(t).dot(e)>=0?1:-1,a=this.cross(t).length*i,r=this.dot(t);return Math.atan2(a,r)}rotateAround(t,e){if(!(t instanceof g))throw new TypeError("axis is not Vector3d object");const i=e.toRadians(),a=this.unit(),r=t.unit(),n=Math.sin(i),s=Math.cos(i),o=1-s,l=r.x,h=r.y,d=r.z,c=[[o*l*l+s,o*l*h-n*d,o*l*d+n*h],[o*l*h+n*d,o*h*h+s,o*h*d-n*l],[o*l*d-n*h,o*h*d+n*l,o*d*d+s]],u=[c[0][0]*a.x+c[0][1]*a.y+c[0][2]*a.z,c[1][0]*a.x+c[1][1]*a.y+c[1][2]*a.z,c[2][0]*a.x+c[2][1]*a.y+c[2][2]*a.z];return new g(u[0],u[1],u[2])}toString(t=3){return`[${this.x.toFixed(t)},${this.y.toFixed(t)},${this.z.toFixed(t)}]`}}Number.prototype.toRadians=function(){return this*Math.PI/180},Number.prototype.toDegrees=function(){return 180*this/Math.PI};var m=g;const f={WGS84:{a:6378137,b:6356752.314245,f:1/298.257223563}},y={WGS84:{ellipsoid:f.WGS84}};Object.freeze(f.WGS84),Object.freeze(y.WGS84);class w{constructor(t,e,i=0){if(isNaN(t))throw new TypeError(`invalid lat ‘${t}’`);if(isNaN(e))throw new TypeError(`invalid lon ‘${e}’`);if(isNaN(i))throw new TypeError(`invalid height ‘${i}’`);this._lat=p.wrap90(Number(t)),this._lon=p.wrap180(Number(e)),this._height=Number(i)}get lat(){return this._lat}get latitude(){return this._lat}set lat(t){if(this._lat=isNaN(t)?p.wrap90(p.parse(t)):p.wrap90(Number(t)),isNaN(this._lat))throw new TypeError(`invalid lat ‘${t}’`)}set latitude(t){if(this._lat=isNaN(t)?p.wrap90(p.parse(t)):p.wrap90(Number(t)),isNaN(this._lat))throw new TypeError(`invalid latitude ‘${t}’`)}get lon(){return this._lon}get lng(){return this._lon}get longitude(){return this._lon}set lon(t){if(this._lon=isNaN(t)?p.wrap180(p.parse(t)):p.wrap180(Number(t)),isNaN(this._lon))throw new TypeError(`invalid lon ‘${t}’`)}set lng(t){if(this._lon=isNaN(t)?p.wrap180(p.parse(t)):p.wrap180(Number(t)),isNaN(this._lon))throw new TypeError(`invalid lng ‘${t}’`)}set longitude(t){if(this._lon=isNaN(t)?p.wrap180(p.parse(t)):p.wrap180(Number(t)),isNaN(this._lon))throw new TypeError(`invalid longitude ‘${t}’`)}get height(){return this._height}set height(t){if(this._height=Number(t),isNaN(this._height))throw new TypeError(`invalid height ‘${t}’`)}get datum(){return this._datum}set datum(t){this._datum=t}static get ellipsoids(){return f}static get datums(){return y}static parse(...t){if(0==t.length)throw new TypeError("invalid (empty) point");let e=void 0,i=void 0,a=void 0;if("object"==typeof t[0]&&(1==t.length||!isNaN(parseFloat(t[1])))){const r=t[0];if("Point"==r.type&&Array.isArray(r.coordinates)?([i,e,a]=r.coordinates,a=a||0):(null!=r.latitude&&(e=r.latitude),null!=r.lat&&(e=r.lat),null!=r.longitude&&(i=r.longitude),null!=r.lng&&(i=r.lng),null!=r.lon&&(i=r.lon),null!=r.height&&(a=r.height),e=p.wrap90(p.parse(e)),i=p.wrap180(p.parse(i))),null!=t[1]&&(a=t[1]),isNaN(e)||isNaN(i))throw new TypeError(`invalid point ‘${JSON.stringify(t[0])}’`)}if("string"==typeof t[0]&&2==t[0].split(",").length&&([e,i]=t[0].split(","),e=p.wrap90(p.parse(e)),i=p.wrap180(p.parse(i)),a=t[1]||0,isNaN(e)||isNaN(i)))throw new TypeError(`invalid point ‘${t[0]}’`);if(null==e&&null==i&&([e,i]=t,e=p.wrap90(p.parse(e)),i=p.wrap180(p.parse(i)),a=t[2]||0,isNaN(e)||isNaN(i)))throw new TypeError(`invalid point ‘${t.toString()}’`);return new this(e,i,a)}toCartesian(){const t=this.datum?this.datum.ellipsoid:this.referenceFrame?this.referenceFrame.ellipsoid:f.WGS84,e=this.lat.toRadians(),i=this.lon.toRadians(),a=this.height,{a:r,f:n}=t,s=Math.sin(e),o=Math.cos(e),l=Math.sin(i),h=Math.cos(i),d=2*n-n*n,c=r/Math.sqrt(1-d*s*s);return new b((c+a)*o*h,(c+a)*o*l,(c*(1-d)+a)*s)}equals(t){if(!(t instanceof w))throw new TypeError(`invalid point ‘${t}’`);return!(Math.abs(this.lat-t.lat)>Number.EPSILON)&&(!(Math.abs(this.lon-t.lon)>Number.EPSILON)&&(!(Math.abs(this.height-t.height)>Number.EPSILON)&&(this.datum==t.datum&&(this.referenceFrame==t.referenceFrame&&this.epoch==t.epoch))))}toString(t="d",e,i=null){if(!["d","dm","dms","n"].includes(t))throw new RangeError(`invalid format ‘${t}’`);const a=(this.height>=0?" +":" ")+this.height.toFixed(i)+"m";if("n"==t){null==e&&(e=4);return`${this.lat.toFixed(e)}, ${this.lon.toFixed(e)}${null==i?"":a}`}return`${p.toLat(this.lat,t,e)}, ${p.toLon(this.lon,t,e)}${null==i?"":a}`}}class b extends m{constructor(t,e,i){super(t,e,i)}toLatLon(t=f.WGS84){if(!t||!t.a)throw new TypeError(`invalid ellipsoid ‘${t}’`);const{x:e,y:i,z:a}=this,{a:r,b:n,f:s}=t,o=2*s-s*s,l=o/(1-o),h=Math.sqrt(e*e+i*i),d=n*a/(r*h)*(1+l*n/Math.sqrt(h*h+a*a)),c=d/Math.sqrt(1+d*d),u=c/d,p=isNaN(u)?0:Math.atan2(a+l*n*c*c*c,h-o*r*u*u*u),g=Math.atan2(i,e),m=Math.sin(p),y=h*Math.cos(p)+a*m-r*r/(r/Math.sqrt(1-o*m*m));return new w(p.toDegrees(),g.toDegrees(),y)}toString(t=0){return`[${this.x.toFixed(t)},${this.y.toFixed(t)},${this.z.toFixed(t)}]`}}const N={WGS84:{a:6378137,b:6356752.314245,f:1/298.257223563},Airy1830:{a:6377563.396,b:6356256.909,f:1/299.3249646},AiryModified:{a:6377340.189,b:6356034.448,f:1/299.3249646},Bessel1841:{a:6377397.155,b:6356078.962818,f:1/299.1528128},Clarke1866:{a:6378206.4,b:6356583.8,f:1/294.978698214},Clarke1880IGN:{a:6378249.2,b:6356515,f:1/293.466021294},GRS80:{a:6378137,b:6356752.31414,f:1/298.257222101},Intl1924:{a:6378388,b:6356911.946,f:1/297},WGS72:{a:6378135,b:6356750.5,f:1/298.26}},M={ED50:{ellipsoid:N.Intl1924,transform:[89.5,93.8,123.1,-1.2,0,0,.156]},ETRS89:{ellipsoid:N.GRS80,transform:[0,0,0,0,0,0,0]},Irl1975:{ellipsoid:N.AiryModified,transform:[-482.53,130.596,-564.557,-8.15,1.042,.214,.631]},NAD27:{ellipsoid:N.Clarke1866,transform:[8,-160,-176,0,0,0,0]},NAD83:{ellipsoid:N.GRS80,transform:[.9956,-1.9103,-.5215,-62e-5,.025915,.009426,.011599]},NTF:{ellipsoid:N.Clarke1880IGN,transform:[168,60,-320,0,0,0,0]},OSGB36:{ellipsoid:N.Airy1830,transform:[-446.448,125.157,-542.06,20.4894,-.1502,-.247,-.8421]},Potsdam:{ellipsoid:N.Bessel1841,transform:[-582,-105,-414,-8.3,1.04,.35,-3.08]},TokyoJapan:{ellipsoid:N.Bessel1841,transform:[148,-507,-685,0,0,0,0]},WGS72:{ellipsoid:N.WGS72,transform:[0,0,-4.5,-.22,0,0,.554]},WGS84:{ellipsoid:N.WGS84,transform:[0,0,0,0,0,0,0]}};Object.keys(N).forEach(t=>Object.freeze(N[t])),Object.keys(M).forEach(t=>{Object.freeze(M[t]),Object.freeze(M[t].transform)});class S extends w{constructor(t,e,i=0,a=M.WGS84){if(!a||null==a.ellipsoid)throw new TypeError(`unrecognised datum ‘${a}’`);super(t,e,i),this._datum=a}get datum(){return this._datum}static get ellipsoids(){return N}static get datums(){return M}static parse(...t){let e=M.WGS84;if((4==t.length||3==t.length&&"object"==typeof t[2])&&(e=t.pop()),!e||null==e.ellipsoid)throw new TypeError(`unrecognised datum ‘${e}’`);const i=super.parse(...t);return i._datum=e,i}convertDatum(t){if(!t||null==t.ellipsoid)throw new TypeError(`unrecognised datum ‘${t}’`);return this.toCartesian().convertDatum(t).toLatLon()}toCartesian(){const t=super.toCartesian();return new v(t.x,t.y,t.z,this.datum)}}class v extends b{constructor(t,e,i,a){if(a&&null==a.ellipsoid)throw new TypeError(`unrecognised datum ‘${a}’`);super(t,e,i),a&&(this._datum=a)}get datum(){return this._datum}set datum(t){if(!t||null==t.ellipsoid)throw new TypeError(`unrecognised datum ‘${t}’`);this._datum=t}toLatLon(t){t&&(console.info("datum parameter to Cartesian_Datum.toLatLon is deprecated: set datum before calling toLatLon()"),this.datum=t);const e=this.datum||M.WGS84;if(!e||null==e.ellipsoid)throw new TypeError(`unrecognised datum ‘${e}’`);const i=super.toLatLon(e.ellipsoid);return new S(i.lat,i.lon,i.height,this.datum)}convertDatum(t){if(!t||null==t.ellipsoid)throw new TypeError(`unrecognised datum ‘${t}’`);if(!this.datum)throw new TypeError("cartesian coordinate has no datum");let e=null,i=null;null!=this.datum&&this.datum!=M.WGS84||(e=this,i=t.transform),t==M.WGS84&&(e=this,i=this.datum.transform.map(t=>-t)),null==i&&(e=this.convertDatum(M.WGS84),i=t.transform);const a=e.applyTransform(i);return a.datum=t,a}applyTransform(t){const{x:e,y:i,z:a}=this,r=t[0],n=t[1],s=t[2],o=t[3]/1e6+1,l=(t[4]/3600).toRadians(),h=(t[5]/3600).toRadians(),d=(t[6]/3600).toRadians();return new v(r+e*o-i*d+a*h,n+e*d+i*o-a*l,s-e*h+i*l+a*o)}}class x{constructor(t,e,i,a,r=S.datums.WGS84,n=null,s=null,o=!0){if(!(1<=t&&t<=60))throw new RangeError(`invalid UTM zone ‘${t}’`);if(t!=parseInt(t))throw new RangeError(`invalid UTM zone ‘${t}’`);if("string"!=typeof e||!e.match(/[NS]/i))throw new RangeError(`invalid UTM hemisphere ‘${e}’`);if(o){if(!(0<=i&&i<=1e6))throw new RangeError(`invalid UTM easting ‘${i}’`);if("N"==e.toUpperCase()&&!(0<=a&&a<9328094))throw new RangeError(`invalid UTM northing ‘${a}’`);if("S"==e.toUpperCase()&&!(1118414<a&&a<=1e7))throw new RangeError(`invalid UTM northing ‘${a}’`)}if(!r||null==r.ellipsoid)throw new TypeError(`unrecognised datum ‘${r}’`);this.zone=Number(t),this.hemisphere=e.toUpperCase(),this.easting=Number(i),this.northing=Number(a),this.datum=r,this.convergence=null===n?null:Number(n),this.scale=null===s?null:Number(s)}toLatLon(){const{zone:t,hemisphere:e}=this,{a:i,f:a}=this.datum.ellipsoid,r=.9996,n=this.easting-5e5,s="S"==e?this.northing-1e7:this.northing,o=Math.sqrt(a*(2-a)),l=a/(2-a),h=l*l,d=l*h,c=l*d,u=l*c,p=l*u,g=i/(1+l)*(1+1/4*h+1/64*c+1/256*p),m=n/(r*g),f=s/(r*g),y=[null,.5*l-2/3*h+37/96*d-1/360*c-81/512*u+96199/604800*p,1/48*h+1/15*d-437/1440*c+46/105*u-1118711/3870720*p,17/480*d-37/840*c-209/4480*u+5569/90720*p,4397/161280*c-11/504*u-830251/7257600*p,4583/161280*u-108847/3991680*p,20648693/638668800*p];let w=f;for(let t=1;t<=6;t++)w-=y[t]*Math.sin(2*t*f)*Math.cosh(2*t*m);let b=m;for(let t=1;t<=6;t++)b-=y[t]*Math.cos(2*t*f)*Math.sinh(2*t*m);const N=Math.sinh(b),M=Math.sin(w),S=Math.cos(w),v=M/Math.sqrt(N*N+S*S);let x=null,_=v;do{const t=Math.sinh(o*Math.atanh(o*_/Math.sqrt(1+_*_))),e=_*Math.sqrt(1+t*t)-t*Math.sqrt(1+_*_);x=(v-e)/Math.sqrt(1+e*e)*(1+(1-o*o)*_*_)/((1-o*o)*Math.sqrt(1+_*_)),_+=x}while(Math.abs(x)>1e-12);const T=_,$=Math.atan(T);let L=Math.atan2(N,S),O=1;for(let t=1;t<=6;t++)O-=2*t*y[t]*Math.cos(2*t*f)*Math.cosh(2*t*m);let A=0;for(let t=1;t<=6;t++)A+=2*t*y[t]*Math.sin(2*t*f)*Math.sinh(2*t*m);const P=Math.atan(Math.tan(w)*Math.tanh(b))+Math.atan2(A,O),C=Math.sin($),W=r*(Math.sqrt(1-o*o*C*C)*Math.sqrt(1+T*T)*Math.sqrt(N*N+S*S))*(g/i/Math.sqrt(O*O+A*A));L+=(6*(t-1)-180+3).toRadians();const F=Number($.toDegrees().toFixed(14)),z=Number(L.toDegrees().toFixed(14)),R=Number(P.toDegrees().toFixed(9)),j=Number(W.toFixed(12)),G=new E(F,z,0,this.datum);return G.convergence=R,G.scale=j,G}static parse(t,e=S.datums.WGS84){if(null==(t=t.trim().match(/\S+/g))||4!=t.length)throw new Error(`invalid UTM coordinate ‘${t}’`);return new this(t[0],t[1],t[2],t[3],e)}toString(t=0){return`${this.zone.toString().padStart(2,"0")} ${this.hemisphere} ${this.easting.toFixed(t)} ${this.northing.toFixed(t)}`}}class E extends S{toUtm(t){if(!(-80<=this.lat&&this.lat<=84))throw new RangeError(`latitude ‘${this.lat}’ outside UTM limits`);let e=t||Math.floor((this.lon+180)/6)+1,i=(6*(e-1)-180+3).toRadians();const a="CDEFGHJKLMNPQRSTUVWXX".charAt(Math.floor(this.lat/8+10));31==e&&"V"==a&&this.lon>=3&&(e++,i+=6..toRadians()),32==e&&"X"==a&&this.lon<9&&(e--,i-=6..toRadians()),32==e&&"X"==a&&this.lon>=9&&(e++,i+=6..toRadians()),34==e&&"X"==a&&this.lon<21&&(e--,i-=6..toRadians()),34==e&&"X"==a&&this.lon>=21&&(e++,i+=6..toRadians()),36==e&&"X"==a&&this.lon<33&&(e--,i-=6..toRadians()),36==e&&"X"==a&&this.lon>=33&&(e++,i+=6..toRadians());const r=this.lat.toRadians(),n=this.lon.toRadians()-i,s=this.datum?this.datum.ellipsoid:S.ellipsoids.WGS84,{a:o,f:l}=s,h=.9996,d=Math.sqrt(l*(2-l)),c=l/(2-l),u=c*c,p=c*u,g=c*p,m=c*g,f=c*m,y=Math.cos(n),w=Math.sin(n),b=Math.tan(n),N=Math.tan(r),M=Math.sinh(d*Math.atanh(d*N/Math.sqrt(1+N*N))),v=N*Math.sqrt(1+M*M)-M*Math.sqrt(1+N*N),E=Math.atan2(v,y),_=Math.asinh(w/Math.sqrt(v*v+y*y)),T=o/(1+c)*(1+1/4*u+1/64*g+1/256*f),$=[null,.5*c-2/3*u+5/16*p+41/180*g-127/288*m+7891/37800*f,13/48*u-.6*p+557/1440*g+281/630*m-1983433/1935360*f,61/240*p-103/140*g+15061/26880*m+167603/181440*f,49561/161280*g-179/168*m+6601661/7257600*f,34729/80640*m-3418889/1995840*f,.6650675310896665*f];let L=E;for(let t=1;t<=6;t++)L+=$[t]*Math.sin(2*t*E)*Math.cosh(2*t*_);let O=_;for(let t=1;t<=6;t++)O+=$[t]*Math.cos(2*t*E)*Math.sinh(2*t*_);let A=h*T*O,P=h*T*L,C=1;for(let t=1;t<=6;t++)C+=2*t*$[t]*Math.cos(2*t*E)*Math.cosh(2*t*_);let W=0;for(let t=1;t<=6;t++)W+=2*t*$[t]*Math.sin(2*t*E)*Math.sinh(2*t*_);const F=Math.atan(v/Math.sqrt(1+v*v)*b)+Math.atan2(W,C),z=Math.sin(r),R=h*(Math.sqrt(1-d*d*z*z)*Math.sqrt(1+N*N)/Math.sqrt(v*v+y*y))*(T/o*Math.sqrt(C*C+W*W));A+=5e5,P<0&&(P+=1e7),A=Number(A.toFixed(9)),P=Number(P.toFixed(9));const j=Number(F.toDegrees().toFixed(9)),G=Number(R.toFixed(12)),k=this.lat>=0?"N":"S";return new x(e,k,A,P,this.datum,j,G,!!t)}}var _=!1;class T{constructor({id_number:t=0,gisOptions:e=null}={}){if(this.id_number=t,this.map_id="vn-map-"+t.toString(),this.map=L.map(this.map_id,e.mapOptions),this.map.zoomControl&&this.map.zoomControl.setPosition("topright"),e.sidePanel){let t="vn-map-ebutton-"+this.id_number.toString();L.easyButton("fas fa-bars",(t,e)=>{let i="vn-sidepanel-"+this.id_number.toString();document.getElementById(i).style.display="block"},"open side-panel controls",t).addTo(this.map)}if(e.locationPopup&&(this.popup=L.popup(),this.map.on("contextmenu",t=>{this.locationPopup(t)})),e.scaleControl){L.control.scale({position:"bottomright",metric:!0,imperial:!1}).addTo(this.map)}e.hasOwnProperty("useCache")&&(_=e.useCache)}addLayer(t){let e;switch(t.layerType){case"geojson":e=function(t,e){let i=e.map,a=null;t.hasOwnProperty("layerOpts")&&(a=t.layerOpts.attribution||null);let r=new L.GeoJSON(null,{style:function(e){let i={color:"#ff0000",weight:2,opacity:1};if(t.hasOwnProperty("style")){t.style.hasOwnProperty("default")&&Object.assign(i,t.style.default);for(const[a,r]of Object.entries(t.style))if(a.indexOf(":")>0){let[t,n]=a.split(":");e.properties.hasOwnProperty(t)&&e.properties[t].toLowerCase()===n.toLowerCase()&&Object.assign(i,r)}}else e.properties.hasOwnProperty("style")&&(i=e.properties.style);return i},onEachFeature:function(a,r){r.on({click:function(e){L.DomEvent.stopPropagation(e);e.latlng.lat,e.latlng.lng;let r="";if(a.properties.hasOwnProperty("name")&&(r+="<b>"+a.properties.name+"</b>"),t.hasOwnProperty("popupProps"))for(let e=0;e<t.popupProps.length;e++){let i=t.popupProps[e];a.properties.hasOwnProperty(i)&&(r+=`<br>${i}: ${a.properties[i]}`)}if(a.properties.hasOwnProperty("KP")){let t=getFeatureKPvalue(a);r+="<br> KP: "+parseFloat(t).toFixed(3)}L.popup().setLatLng(e.latlng).setContent(r).openOn(i)},contextmenu:function(t){L.DomEvent.stopPropagation(t);let i="";if(a.properties.hasOwnProperty("name")&&(i+="<b>"+a.properties.name+"</b>"),a.properties.hasOwnProperty("KP")){let t=getFeatureKPvalue(a);i+="<br> KP: "+parseFloat(t).toFixed(3)}e.locationPopup(t,i)}})},attribution:a}),n=!1;_&&t.cache&&(n=localStorage.getItem(t.layerId));n?(console.log("localStorage retrieving "+t.layerId),n=LZString.decompressFromUTF16(n),n=JSON.parse(n),console.log("dataObj.cache_timestamp "+n.cache_timestamp),r.addData(n.data)):fetch(t.url).then(e=>{200!=e.status&&console.error(`loadGeojson failure\nurl=«${url}»\nfetch response status code: ${e.status}`),e.json().catch(t=>{console.error("loadGeojson failure\nresp.json():",t)}).then(e=>{console.log("loadGeojson data",e),r.addData(e),n={cache_timestamp:Date.now(),type:"geojson",data:e},n=JSON.stringify(n),console.log("dataObj length",n.length),n=LZString.compressToUTF16(n),console.log("compressed length",n.length);try{localStorage.setItem(t.layerId,n)}catch(e){console.error(`localStorage ${e} ${t.layerId}`)}})}).catch(e=>{console.error(`loadGeojson fetch(${t.url}) failure: ${e}`)});return r}(t,this);break;case"tilemap":e=L.tileLayer(t.url,t.layerOpts);break;case"WMS":e=L.tileLayer.wms(t.url,t.layerOpts)}return this.map.addLayer(e),L.Util.stamp(e)}getLayerByStamp(t){let e=[];this.map.eachLayer(t=>{e.push(t)});for(let i=0;i<e.length;i++)if(e[i]._leaflet_id==t)return e[i]}removeLayerByStamp(t){let e=this.getLayerByStamp(t);this.map.removeLayer(e)}removeAllLayers(){this.map.eachLayer(t=>{this.map.removeLayer(t)})}getAllAttributions(){let t=[];this.map.eachLayer(e=>{t.push(e)});let e=[];for(let i=0;i<t.length;i++)e.push(t[i].getAttribution());return e}locationPopup(t,e=null){let i,a="https://www.gebco.net/data_and_products/gebco_web_services/web_map_service/mapserv",r=this.map.layerPointToContainerPoint(t.layerPoint).x,n=this.map.layerPointToContainerPoint(t.layerPoint).y,s=this.map.getSize(),o=this.popup;i=e?e+"<br>Location coordinates:":"Location coordinates:";let l={request:"GetFeatureInfo",service:"WMS",srs:"EPSG:4326",version:"1.1.1",bbox:this.map.getBounds().toBBoxString(),x:r,y:n,height:s.y,width:s.x,layers:"GEBCO_LATEST_2",query_layers:"GEBCO_LATEST_2",info_format:"text/html"},h=a+L.Util.getParamString(l,a,!0),d=$.ajax({url:h,dataType:"html",success:function(t){console.log("getinfo successfully loaded!\n",t)},error:function(t){console.log("getinfo ERROR!\n",t.statusText)}});$.when(d).done((function(){let t=$.parseHTML(d.responseText);$(t).find("body:first");$.each(t,(function(t,e){if("#text"==e.nodeName){let t=e.nodeValue.match(/Elevation value \(m\):\s*(-?\d+)/);if(t){let e=t[1];i+=e>=0?"<br>elevation "+e+" m (GEBCO)":"<br>depth "+e+" m (GEBCO)",o.setContent(i)}}}))}));let c=t.latlng.lat,u=t.latlng.lng;console.log("long",u,"lat",c);let p=new E(c,u),g=p.convertDatum(E.datums.ED50);console.log("latlong_WGS84 ",p.toString()),g=new E(g.lat,g.lon,0,E.datums.ED50);let m=g.toUtm();i+="<br>long. "+u.toFixed(5)+"&deg;  lat. "+c.toFixed(5)+"&deg; (WGS84)",i+="<br>UTM zone "+m.zone+m.hemisphere,i+="<br>E"+m.easting.toFixed(1)+" N"+m.northing.toFixed(1)+" (ED50)",this.popup.setLatLng(t.latlng).setContent(i).openOn(this.map)}}class O{constructor({app_id:t,gisOptions:e,ftree_vnleaf_0:i,id_number:h=0,title:c="qwleaf testing..."}={}){this.id_number=h,this.id=t,document.title=c;const u=document.getElementById(t),p=document.createElement("div");this.sidepanel_id="vn-sidepanel-"+this.id_number.toString(),p.setAttribute("id",this.sidepanel_id),p.setAttribute("class","w3-sidebar w3-bar-block w3-border-right"),p.setAttribute("style","display:none;z-index:2000;width:300px;height:100%;"),u.appendChild(p);const g=document.createElement("div");g.setAttribute("class","w3-row"),p.appendChild(g);const m=document.createElement("div");m.setAttribute("class","w3-col w3-right w3-blue-grey"),m.setAttribute("style","width:40px;height:50px;"),g.appendChild(m);const f=document.createElement("button");f.setAttribute("class","w3-bar-item w3-button w3-dark-grey"),f.setAttribute("title","close side panel"),f.setAttribute("style","width:40px;height:50px;"),f.onclick=t=>{this.sidepanel_close()},m.appendChild(f);const y=document.createElement("i");y.setAttribute("class","fas fa-caret-left w3-xxlarge"),f.appendChild(y);const w=document.createElement("div");w.setAttribute("class","w3-rest w3-center w3-blue-grey"),w.setAttribute("style","height:50px;"),g.appendChild(w),this.spTopTitleCol=w;const b=document.createElement("div");b.setAttribute("class","w3-row"),b.setAttribute("style","height:100%;"),p.appendChild(b);const N=document.createElement("div");N.setAttribute("class","w3-col w3-border w3-light-gray"),N.setAttribute("style","width:32px;height:100%;"),b.appendChild(N),this.spTabCol=N;const M=document.createElement("div");M.setAttribute("class","w3-rest"),b.appendChild(M),this.spMainCol=M,u.setAttribute("style","position:fixed; top:0; left:0; bottom:0; right:0;");const S="vn-map-"+h.toString(),v=document.createElement("div");v.setAttribute("style","width: 100%; height: 100%; margin: 0 auto;"),v.setAttribute("id",S),u.appendChild(v),this.gis=new T({id_number:this.id_number,gisOptions:e});const x=this.createSpWidget("layers","Select map layers","fas fa-layer-group");let E="vn-datatree-"+this.id_number.toString();x.setAttribute("id",E),console.log("datatree_id="+E),E=((t=null,e=0,i=null)=>{const h="vn-datatree-"+e.toString();return $("#"+h).fancytree({extensions:["glyph"],glyph:{preset:"awesome5",map:{}},imagePath:"",types:{"folder-gis-basemaps":{iconTooltip:"select the base map"},"gis-layer-basemap":{icon:!1},"gis-layer":{icon:!1},"gis-folder-flag-au":{icon:"flag-icon-background flag-icon-au"},"gis-folder-flag-dk":{icon:"flag-icon-background flag-icon-dk"},"gis-folder-flag-gb":{icon:"flag-icon-background flag-icon-gb"},"gis-folder-flag-gb-sct":{icon:"flag-icon-background flag-icon-gb-sct"},"gis-folder-flag-ie":{icon:"flag-icon-background flag-icon-ie"},"gis-folder-flag-no":{icon:"flag-icon-background flag-icon-no"},"gis-folder-flag-us":{icon:"flag-icon-background flag-icon-us"}},icon:r,iconTooltip:n,select:s,lazyLoad:o,init:l,source:t,id_number:e,targetWidget:i,treeId:"vn-fancytree-"+e.toString(),createNode:a}),$.contextMenu({selector:"#"+h+" span.fancytree-title",build:d}),h})(i,this.id_number,this.gis),console.log("datatree_id="+E),this.datatree=((t=0)=>{const e="vn-datatree-"+t.toString();return $.ui.fancytree.getTree("#"+e)})(this.id_number),this.createSpWidget("attributions","Map attributions","far fa-copyright"),this.createSpWidget("info","Map information","fas fa-info").innerHTML='<div class="w3-container w3-border"> \n    <h2>Information</h2>\n    <p>London is the most populous city in the United Kingdom,\n    with a metropolitan area of over 9 million inhabitants.</p>\n    <hr>\n  </div>',this.createSpWidget("help","Help","fas fa-question").innerHTML='<div class="w3-container w3-border"> \n<h2>Cavan</h2>\n<p>Cavan is the most populous city in the United Kingdom,\nwith a metropolitan area of over 9 million inhabitants.</p>\n<hr>\n</div>',this.createSpWidget("options","Options","fas fa-cog").innerHTML='<div class="w3-container w3-border"> \n  <h2>London</h2>\n  <p>London is the most populous city in the United Kingdom,\n  with a metropolitan area of over 9 million inhabitants.</p>\n  <hr>\n</div>',this.showSidepanelWidget("layers")}sidepanel_open(){document.getElementById(this.sidepanel_id).style.display="block"}sidepanel_close(){let t="vn-sidepanel-"+this.id_number;document.getElementById(t).style.display="none"}showSidepanelWidget(t){for(let e=0;e<this.spMainCol.childNodes.length;e++){let i=this.spMainCol.childNodes[e];if(t===i.getAttribute("data-ident")){let t=i.getAttribute("data-title");this.spTopTitleCol.innerHTML="<p>"+t+"</p>",i.style.display="block"}else i.style.display="none"}}createSpWidget(t,e,i){const a=document.createElement("div");a.setAttribute("style","display:none;"),a.setAttribute("data-ident",t),a.setAttribute("data-title",e),this.spMainCol.appendChild(a);const r=document.createElement("button");let n;switch(r.setAttribute("class","w3-button w3-dark-grey"),r.setAttribute("style","margin:1px;padding:4px 2px 2px 2px;height:32px;width:32px;"),r.setAttribute("title",e),t){case"attributions":n=e=>{this.showSidepanelWidget(t);let i=this.gis.getAllAttributions(),r="<ul class='w3-ul w3-border w3-small'>";for(let t=0;t<i.length;t++){if(!i[t])continue;let e="";this.datatree.getRootNode().visit(a=>{if(a.data.hasOwnProperty("layerOpts")&&a.data.layerOpts.hasOwnProperty("attribution")&&a.data.layerOpts.attribution===i[t])return e=`<b>${a.title}</b>: `,!1}),r+="<li>"+e+i[t]+"</li>"}r+="</ul>",a.innerHTML=r};break;default:n=e=>{this.showSidepanelWidget(t)}}r.onclick=n;const s=document.createElement("i");return s.setAttribute("class",i),r.appendChild(s),this.spTabCol.appendChild(r),a}onActivateRequest(t){console.log("onActivateRequest(",this.id,t)}onAfterHide(t){console.log("onAfterHide",this.id,t)}onAfterShow(t){console.log("onAfterShow",this.id,t)}onAfterAttach(t){console.log("onAfterAttach",this.id,t)}onCloseRequest(t){console.log("onCloseRequest",this.id,t)}onResize(t){this.map&&console.log("onResize",this.id,t)}}window.onload=()=>{!function(){let t,e,i,a=new URL(window.location.href);a.searchParams.has("conf")?(i=a.searchParams.get("conf"),e="/gis/assets/"+i+".vnleaf.json"):(console.log("main using default config",conf_data_path),e=conf_data_path),fetch(e).then(e=>{200!=e.status&&console.error(`load_config failure\nurl=«${a}»\nfetch response status code: ${e.status}`),e.json().catch(t=>{console.error("load_config failure\nresp.json():",t)}).then(e=>{console.log("confData",e),t=new O(e)})}).catch(t=>{console.error(`fetch(${e}) failure top-level: ${t}`)})}()}}]);